"use strict";
(() => {
  // widget-src/assets/svg/node-add.tsx
  var node_add_default = `<?xml version="1.0" encoding="iso-8859-1"?>
<!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 511.999 511.999" style="enable-background:new 0 0 511.999 511.999;" xml:space="preserve">
<polygon style="fill:#CFF09E;" points="96.838,469.769 109.281,64.007 415.16,330.906 228.277,336.788 "/>
<g>
	<path style="fill:#507C5C;" d="M424.072,320.69L118.194,53.791c-3.948-3.446-9.53-4.306-14.334-2.211
		c-4.805,2.096-7.971,6.774-8.131,12.011L83.287,469.353c-0.171,5.571,3.084,10.68,8.208,12.876
		c1.723,0.739,3.539,1.098,5.341,1.098c3.552,0,7.045-1.398,9.645-4.028l90.792-91.858l50.786,116.421
		c1.439,3.296,4.126,5.886,7.473,7.199c1.594,0.625,3.274,0.937,4.954,0.937c1.848,0,3.695-0.378,5.421-1.131l64.367-28.079
		c6.865-2.994,10.001-10.985,7.007-17.849l-31.989-73.329c-2.995-6.863-10.986-10.002-17.848-7.006
		c-6.865,2.994-10.001,10.986-7.007,17.849l26.569,60.902l-39.514,17.237l-49.693-113.918l16.315-16.506l181.472-5.712
		c5.571-0.175,10.468-3.742,12.343-8.992C429.801,330.216,428.272,324.355,424.072,320.69z M237.031,322.948l-50.268-115.235
		c-2.995-6.863-10.986-10.002-17.848-7.006c-6.865,2.994-10.001,10.985-7.007,17.849l50.268,115.235L111.447,435.7l10.506-342.641
		l258.297,225.38L237.031,322.948z"/>
	<path style="fill:#507C5C;" d="M350.262,171.972H306.59c-7.487,0-13.558-6.07-13.558-13.558V121.38h-37.033
		c-7.487,0-13.558-6.07-13.558-13.558V64.149c0-7.488,6.071-13.558,13.558-13.558h37.033V13.558C293.032,6.07,299.103,0,306.59,0
		h43.672c7.487,0,13.558,6.07,13.558,13.558v37.033h37.033c7.487,0,13.558,6.07,13.558,13.558v43.672
		c0,7.488-6.071,13.558-13.558,13.558h-50.591c-7.487,0-13.558-6.07-13.558-13.558s6.071-13.558,13.558-13.558h37.033V77.707
		h-37.033c-7.487,0-13.558-6.07-13.558-13.558V27.116h-16.556v37.033c0,7.488-6.071,13.558-13.558,13.558h-37.033v16.556h37.033
		c7.487,0,13.558,6.07,13.558,13.558v37.033h30.114c7.487,0,13.558,6.07,13.558,13.558
		C363.821,165.901,357.749,171.972,350.262,171.972z"/>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
</svg>
`;

  // widget-src/assets/svg/play-button.tsx
  var play_button_default = `<?xml version="1.0" encoding="iso-8859-1"?>
<!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 60 60" style="enable-background:new 0 0 60 60;" xml:space="preserve">
<g>
	<path d="M45.563,29.174l-22-15c-0.307-0.208-0.703-0.231-1.031-0.058C22.205,14.289,22,14.629,22,15v30
		c0,0.371,0.205,0.711,0.533,0.884C22.679,45.962,22.84,46,23,46c0.197,0,0.394-0.059,0.563-0.174l22-15
		C45.836,30.64,46,30.331,46,30S45.836,29.36,45.563,29.174z M24,43.107V16.893L43.225,30L24,43.107z"/>
	<path d="M30,0C13.458,0,0,13.458,0,30s13.458,30,30,30s30-13.458,30-30S46.542,0,30,0z M30,58C14.561,58,2,45.439,2,30
		S14.561,2,30,2s28,12.561,28,28S45.439,58,30,58z"/>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
</svg>
`;

  // widget-src/embedded_ui/dist/edit_panel/index.html.ts
  var index_html_default = `
            <div>VelocityX: <input id="velocityX" type="number" value="" /></div>
<div>VelocityY: <input id="velocityY" type="number" value="" /></div>
<button id="submit">Submit</button>

            <script>
                "use strict";
(() => {
  // widget-src/embedded_ui/edit_panel/index.ts
  var submitButton = document.getElementById("submit" /* submit */);
  var velocityX = document.getElementById(
    "velocityX" /* velocityX */
  );
  var velocityY = document.getElementById(
    "velocityY" /* velocityY */
  );
  var currentNodeState;
  addEventListener("message", (event) => {
    var _a, _b;
    console.log(event);
    const data = event.data;
    const typ = (_a = data == null ? void 0 : data.pluginMessage) == null ? void 0 : _a.type;
    switch (typ) {
      case "WidgetState" /* NodeState */:
        const body = (_b = data == null ? void 0 : data.pluginMessage) == null ? void 0 : _b.body;
        currentNodeState = body.nodeState;
        velocityX.value = currentNodeState.velocityX.toString();
        velocityY.value = currentNodeState.velocityY.toString();
        console.log("set current node state");
        break;
      default:
        break;
    }
  });
  if (submitButton) {
    submitButton.onclick = () => {
      console.log("submit click");
      const velocityX2 = document.getElementById("velocityX").valueAsNumber;
      const velocityY2 = document.getElementById("velocityY").valueAsNumber;
      const message = {
        pluginMessage: {
          type: "nodeUpdate",
          nodeId: currentNodeState == null ? void 0 : currentNodeState.id,
          velocityX: velocityX2,
          velocityY: velocityY2,
          nodeVersion: ""
        }
      };
      parent.postMessage(message, "*");
    };
  }
})();

            <\/script>
        `;

  // widget-src/embedded_ui/dist/play_panel/index.html.ts
  var index_html_default2 = `
            <div></div>

            <script>
                "use strict";
(() => {
  // widget-src/consts.ts
  var FPS = 30;

  // widget-src/embedded_ui/play_panel/index.ts
  setInterval(() => {
    const message = { pluginMessage: { type: "tick" } };
    parent.postMessage(message, "*");
  }, 1e3 / FPS);
})();

            <\/script>
        `;

  // widget-src/node.ts
  var defaultNodeState = (id) => {
    return {
      id,
      version: 0,
      velocityX: 0,
      velocityY: 0
    };
  };

  // widget-src/consts.ts
  var FPS = 30;

  // widget-src/code.tsx
  var { widget } = figma;
  var { AutoLayout, SVG, useEffect, useSyncedMap } = widget;
  function Widget() {
    const nodeStateById = useSyncedMap("nodeState");
    useEffect(() => {
      figma.ui.onmessage = (message) => {
        console.log("message", message);
        if (message.type === "nodeUpdate") {
          const node = figma.getNodeById(message.nodeId);
          if ((node == null ? void 0 : node.type) === "FRAME") {
            const prevState = nodeStateById.get(node.id);
            nodeStateById.set(node.id, {
              id: node.id,
              version: ((prevState == null ? void 0 : prevState.version) || 0) + 1,
              velocityX: message.velocityX,
              velocityY: message.velocityY
            });
          } else {
            console.error("not a frame");
          }
          figma.closePlugin();
        } else if (message.type === "tick") {
          for (const [nodeId, nodeState] of nodeStateById.entries()) {
            const node = figma.getNodeById(nodeId);
            if ((node == null ? void 0 : node.type) !== "FRAME") {
              console.error("non frame object in nodes");
              return;
            }
            node.x += nodeState.velocityX / FPS;
            node.y += nodeState.velocityY / FPS;
          }
        }
      };
    });
    return /* @__PURE__ */ figma.widget.h(AutoLayout, {
      verticalAlignItems: "center",
      spacing: 8,
      padding: 16,
      cornerRadius: 8,
      fill: "#FFFFFF",
      stroke: "#E6E6E6"
    }, /* @__PURE__ */ figma.widget.h(SVG, {
      src: play_button_default,
      width: 50,
      height: 50,
      onClick: () => {
        console.log("running script!");
      }
    }), /* @__PURE__ */ figma.widget.h(SVG, {
      src: node_add_default,
      width: 50,
      height: 50,
      onClick: () => {
        return new Promise((resolve) => {
          if (figma.currentPage.selection.length !== 1) {
            console.error("Select a single frame/ object to edit");
            return;
          }
          const node = figma.currentPage.selection[0];
          let nodeState = nodeStateById.get(node.id);
          if (!nodeState) {
            console.log("setting node state", defaultNodeState(node.id));
            nodeState = defaultNodeState(node.id);
            console.log(node.id);
          }
          console.log("node state", nodeState);
          figma.showUI(index_html_default);
          figma.ui.postMessage({
            type: "WidgetState" /* NodeState */,
            body: {
              nodeState
            }
          });
        });
      }
    }), /* @__PURE__ */ figma.widget.h(SVG, {
      src: play_button_default,
      width: 50,
      height: 50,
      onClick: () => {
        return new Promise((resolve) => {
          figma.showUI(index_html_default2, {
            visible: false
          });
        });
      }
    }));
  }
  widget.register(Widget);
})();
